<html>
<head>
<style>
table, th, td {
  border: 1px solid black;
}
td:hover {
  background-color: lightgreen;
  color: #000000;
}
</style>
<script>

var testA=[1,2,3];

var sentences= 
[

['van.mp3', 
   [
[24,29],
[29,33],
[33,37],
[37,41],
[41,45],
[45,49],
[49,53],
[53,57],
[57,61],
[61,64],
[67,70],
[70,75],
[75,79],
[79,83],
[83,87],
[87,91],
[91,95],
[95,99],
[99,103],
[103,107],
[109,113],
[113,117],
[117,120],
[120,123],
[123,127],
[127,131],
[131,134],
[134,138],
[138,141],
[141,146],
[151,155],
[155,159],
[159,163],
[163,166],
[166,170],
[170,173],
[173,177],
[177,180],
[180,184],
[184,187],
[187,192],
[192,196],
[196,200],
[200,204],
[204,208],
[208,212],
[212,216],
[216,220],
[220,223],
[223,228],
[230,233],
[233,236],
[236,240],
[240,244],
[244,247],
[247,251],
[251,254],
[254,258],
[258,262],
[262,265],
[267,271],
[271,275],
[275,278],
[278,282],
[282,285],
[285,289],
[289,292],
[292,296],
[296,300],
[300,304],
[307,310],
[310,313],
[313,317],
[317,320],
[320,323],
[323,326],
[326,330],
[330,333],
[333,337],
[337,341],
[341,345],
[345,349],
[349,354],
[354,358],
[358,362],
[362,367],
[367,372],
[372,376],
[376,380],
[380,384],
[391,396],
[396,399],
[399,402],
[402,406],
[406,410],
[410,414],
[414,417],
[417,421],
[421,425],
[425,429],
[429,432],
[432,436],
[436,440],
[440,444],
[444,448],
[448,451],
[451,454],
[454,456],
[456,459],
[459,462],
[465,469],
[469,474],
[474,478],
[478,482],
[482,486],
[486,491],
[491,495],
[495,499],
[499,503],
[503,507],
[507,511],
[511,516],
[516,520],
[520,524],
[524,528],
[528,532],
[532,536]
], 'Tong Hop Van',

   [
'ia',
'ua',

'oam',

'oap'
]


 ]
];

let video_index = 0;
let time_index = 0;
let repeat = 0;

let pauseOrNot=false;

let repeatTimes = 2;
var video;

//var video=document.getElementById("myVideo");


var maxTime;

document.addEventListener('DOMContentLoaded', () => {
  video = document.getElementById("myVideo");
  video.defaultPlaybackRate = 0.75;

  video.addEventListener("timeupdate", function(){
    if(video.currentTime >= maxTime){
       myLoop();
       var popupwin = window.open('http://www.google.com','anyname','width=10,height=1,left=5,top=3');
       popupwin.close();
    }
  }, false);
});

function playVideo(myUrl, startTime, endTime) { 
  highlightWord(time_index);
  document.getElementById("demo").innerHTML +=myUrl + " start:"+startTime+" end: "+endTime+" time_index" +time_index+ "<br>";
  document.getElementById("bodydesc").scrollTop = document.getElementById("bodydesc").scrollHeight;
  //video.defaultPlaybackRate = 0.75;
  video.src = 'video/'+myUrl;
  //video.src = myUrl;
  video.currentTime=startTime;
  video.play();
  maxTime = endTime;
} 


function readWord(wordId){
  time_index=wordId-1;
  highlightWord(time_index);
  myLoop();
}

function arr2tbl(ncols, words){
 return words.reduce((a,c,i)=>{
 if(i%ncols==0)a.push([]);
   a.at(-1).push([c,i+1]);
   return a;
  },[]).map(r=>"<tr>"+r.map(c=>`<td id="${c[1]}" onclick=readWord("${c[1]}") >${c[0]}</td>`).join("")+"</tr>").join("\n");
}

function showWords(myVid_index){
  var table = document.getElementById('wordTable');
  // Clear the existing table content
  table.innerHTML = '';
  var words=sentences[myVid_index][3];
  table.innerHTML= arr2tbl(10, words);

}

function  highlightWord(myTime_index){
  //get all <td> elements within the table with id 'wordTable'
  var tdElements = document.querySelectorAll('#wordTable td');

  //loop through each <td> element and remove its inline style
  tdElements.forEach(function(td) {
    td.style = '';
  });

  //document.getElementById("wordNo").innerHTML ="<b>"+myTime_index+"</b>";
  document.getElementById(myTime_index+1).style.color ="red";
  document.getElementById(myTime_index+1).style.fontWeight ="bold";
  document.getElementById(myTime_index+1).style.backgroundColor="lightblue";
}

function playAllVideos(){
  let text = "Do you want to play this video?";
  if (confirm(text) == true) {
    video_index = 0;
    time_index = 0;
    repeat = 0;
    myLoop();
  }
}

function updateRepeatTimes(repeatTimes_index){
  repeatTimes =repeatTimes_index;
  repeat=0; 
  myLoop();
}

function myLoop(){
  if (!sentences[video_index]) {
    //video.src = null;
    //return;  
    video_index = 0;
    time_index = 0;
    repeat = 0;

  }

  playVideo(sentences[video_index][0], sentences[video_index][1][time_index][0], sentences[video_index][1][time_index][1]);


  if (repeat==0){
     if (pauseOrNot==true){
        video.pause();
     }
  }   
  repeat++;
  
  

  if (repeat >= repeatTimes) {
    repeat = 0;
    time_index++;
    if (time_index >= sentences[video_index][1].length) {
      time_index = 0;
      video_index++;    
    }
    
  }

}

function moveBackwardTimeindex(){
  if (time_index>0){
     time_index--;
     repeat=0;
     myLoop();
  }
  else{
     time_index=0;
  }
}

function moveForwardTimeindex(){
   if (time_index<sentences[video_index][1].length){
      time_index++; 
      repeat=0; 
      myLoop();
   }
}

function jumpToVideo(vid_index){
//    alert (vid_index);
    
  let text = "Do you want to play this video?";
  if (confirm(text) == true) {
    video_index = vid_index;
    time_index = 0;
    repeat = 0;
    showWords(vid_index);
    myLoop();
  } 

    
}

function listVideos(){
  var vid_index=0;
  for (const sentence of sentences) {
     
     const [video, timers,videoName] = sentence
     var videoLink="<a href='#' onclick='jumpToVideo("+vid_index+")' >" + videoName + "</a><br><br>";
     //alert (videoLink);
     document.getElementById("allVideos").innerHTML +=videoLink;
     vid_index++;
  }
  document.getElementById("allVideos").style.fontSize = "x-large";
  hideVideo();
}


function hideVideo() {
  document.getElementById("myVideo").style.visibility = "hidden";
}
function unhideVideo() {
  let passW = prompt("Please enter password", "");
  if (passW == "123456") {
     document.getElementById("myVideo").style.visibility = "visible";
  }
  
}

</script>
</head>
<body onload="listVideos()">

<table id="wordTable" style="font-size:30px">
</table>


<br>

<table border=2>
<tr>
<td>
<a href="#" onclick="playAllVideos()" style="font-size: 20px; text-decoration: none" > Play All Videos</a>
</td>
<td>
<a href="#" onclick="pauseOrNot=true" style="font-size: 20px; text-decoration: none" > Pause = True </a>
</td>
<td>
<a href="#" onclick="pauseOrNot=false" style="font-size: 20px; text-decoration: none" > Pause = false </a>
</td>
<td>
<a href="#" onclick="moveForwardTimeindex()" style="font-size: 20px; text-decoration: none" > Move Forward Time Index </a>
</td>
<td>
<a href="#" onclick="moveBackwardTimeindex()" style="font-size: 20px; text-decoration: none" > Move Backward Time Index </a>
</td>


</tr>
<tr>


<td>
<a href="#" onclick="updateRepeatTimes(1)" style="font-size: 20px; text-decoration: none" > Repeat Once </a>
</td>

<td>
<a href="#" onclick="updateRepeatTimes(2)" style="font-size: 20px; text-decoration: none" > Repeat Twice </a>
</td>

<td>
<a href="#" onclick="updateRepeatTimes(3)" style="font-size: 20px; text-decoration: none" > Repeat 3 Times </a>
</td>

<td>
<a href="#" onclick="updateRepeatTimes(4)" style="font-size: 20px; text-decoration: none" > Repeat 4 Times </a>
</td>


<td>
<a href="#" onclick="updateRepeatTimes(5)" style="font-size: 20px; text-decoration: none" > Repeat 5 Times </a>
</td>

</tr>
</table>
<br>


<p id="allVideos"></p>

<br><br>

<a href="#" onclick="hideVideo()" style="font-size: 30px; text-decoration: none" >Hide</a>
<a href="#" onclick="unhideVideo()" style="font-size: 30px; text-decoration: none" >Unhide</a>
<br>
<table>
<tr>
<td>
<video id="myVideo" width="200" height="200" controls autoplay loop>

  Your browser does not support the video tag.
</video>

</td>
<td>

<div id="bodydesc" style="margin-left:auto; margin-right:auto; width:560px; height: 400px; overflow-y: scroll;">

    <p id="demo">

     

    </p>

</div>

</td>
  
</tr>
</table>
</body>
</html>